"use client";

import React, { useRef } from "react";
import { useGSAP } from "@gsap/react";
import gsap from "gsap";

gsap.registerPlugin(useGSAP);

export const Hand = React.forwardRef<SVGSVGElement, React.SVGProps<SVGSVGElement>>(
  (props, ref) => {
    const svgRef = useRef<SVGSVGElement | null>(null);
    const swayRef = useRef<SVGGElement | null>(null);   // медленное покачивание
    const microRef = useRef<SVGGElement | null>(null);  // мягкие микроподстройки

    useGSAP(
      () => {
        const svg = svgRef.current!;
        const sway = swayRef.current!;
        const micro = microRef.current!;

        const reduce = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;
        if (reduce) return;

        // Точка «запястья» (можно чутка подправить под свой макет)
        const ORIGIN_X = 170;
        const ORIGIN_Y = 490;

        // Базовое плавное покачивание (меньше амплитуда, больше длительность)
        gsap.set(sway, { svgOrigin: `${ORIGIN_X} ${ORIGIN_Y}` });
        const swayTl = gsap.timeline({
          repeat: -1,
          yoyo: true,
          defaults: { ease: "sine.inOut" },
        });
        swayTl
          .to(sway, { rotation: 1.1, x: 1.2, y: -0.8, duration: 2.4 })
          .to(sway, { rotation: -0.9, x: -1.0, y: 0.7, duration: 2.2 });

        // Мягкие микроподстройки (плавные небольшие дрейфы, без «рывков»)
        const rand = gsap.utils.random;
        gsap.set(micro, { svgOrigin: `${ORIGIN_X} ${ORIGIN_Y}` });
        const microTween = gsap.to(micro, {
          x: () => rand(-0.4, 0.4),
          y: () => rand(-0.6, 0.6),
          rotation: () => rand(-0.35, 0.35),
          duration: () => rand(0.28, 0.48),   // медленнее, плавнее
          ease: "sine.inOut",
          repeat: -1,
          repeatRefresh: true,
        });

        return () => {
          swayTl.kill();
          microTween.kill();
        };
      },
      { scope: svgRef }
    );

    const combinedRef = (el: SVGSVGElement | null) => {
      svgRef.current = el;
      if (typeof ref === "function") ref(el as SVGSVGElement);
      else if (ref) (ref as React.MutableRefObject<SVGSVGElement | null>).current = el;
    };

    return (
      <svg
        ref={combinedRef}
        width="340"
        height="548"
        viewBox="0 0 340 548"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        {...props}
      >
        {/* Внешний слой — плавное покачивание */}
        <g ref={swayRef}>
          {/* Внутренний слой — мягкие микроподстройки */}
          <g ref={microRef}>
            {/* Твой исходный SVG руки без изменений */}
            <g clipPath="url(#clip0_2090_9254)">
              <path d="M22.7421 259.362C22.7902 259.471 22.8383 259.574 22.8864 259.677C23.3807 260.646 23.7583 261.251 23.8338 261.374C24.0741 261.752 24.2046 262.185 24.232 262.619C41.6572 299.577 74.5715 323.948 93.0743 333.609C95.684 334.968 96.0814 333.265 95.1753 331.739C89.1749 321.66 81.7667 308.364 77.3178 298.01C67.3419 274.794 59.4463 249.577 55.4985 231.885C55.4505 231.85 55.4024 231.816 55.3543 231.775C54.8188 231.294 41.8838 220.033 28.1386 231.301C15.897 241.339 20.2018 254.105 22.6391 259.176C22.6735 259.238 22.7147 259.293 22.7421 259.362Z" fill="#FFB689" />
              <path d="M22.7421 259.362C22.7902 259.471 22.8383 259.574 22.8864 259.677C23.3807 260.646 23.7583 261.251 23.8338 261.374C24.0741 261.752 24.2046 262.185 24.232 262.619C41.6572 299.577 74.5715 323.948 93.0743 333.609C95.684 334.968 96.0814 333.265 95.1753 331.739C89.1749 321.66 81.7667 308.364 77.3178 298.01C67.3419 274.794 59.4463 249.577 55.4985 231.885C55.4505 231.85 55.4024 231.816 55.3543 231.775C54.8188 231.294 41.8838 220.033 28.1386 231.301C15.897 241.339 20.2018 254.105 22.6391 259.176C22.6735 259.238 22.7147 259.293 22.7421 259.362Z" fill="url(#paint0_linear_2090_9254)" />
              <path d="M325.212 610.836C311.995 579.635 283.503 529.877 222.789 470.037C221.869 469.131 221.759 467.674 222.542 466.643C223.016 466.011 270.52 402.861 305.151 348.636C338.202 296.884 335.634 284.489 327.12 243.415C326.682 241.305 326.228 239.12 325.769 236.853C322.569 221.201 322.006 207.94 321.559 197.283C320.935 182.407 320.406 175.207 315.264 174.101C313.059 173.634 301.223 175.413 290.238 186.015C278.326 197.517 265.858 221.029 274.117 267.717C274.241 268.425 274.07 269.159 273.63 269.73C273.191 270.308 272.538 270.672 271.824 270.74C270.794 270.843 246.373 273.709 244.128 305.466C244.046 306.661 243.228 307.733 242.048 307.966C240.729 308.227 239.46 307.452 239.075 306.187C238.374 303.893 168.804 76.4171 156.034 35.4666C148.179 10.2847 139.693 2.64421 133.954 0.665392C129.545 -0.853079 125.969 0.665391 123.744 2.21135C117.998 6.1896 111.682 24.1364 111.063 47.2708C110.679 61.5279 112.189 96.5558 134.42 113.801C135.114 114.338 135.484 115.19 135.409 116.069C135.347 116.791 129.649 186.173 152.772 212.846C154.352 214.44 155.272 215.436 155.409 215.587C156.459 216.741 156.281 218.597 154.908 219.504C153.892 220.17 152.546 219.971 151.661 219.14C150.774 218.308 149.972 217.47 149.175 216.57C138.726 206.085 96.9199 167.34 69.2717 188.145C60.3738 194.837 58.0737 205.487 57.9227 214.261C58.3552 226.203 67.4592 261.987 82.0626 295.977C89.9171 314.253 97.991 328.909 105.976 339.607C106.14 339.772 106.278 339.958 106.395 340.157C112.911 348.773 119.371 354.744 125.605 357.863C130.596 360.364 136.521 357.073 137.078 351.515C137.359 348.69 137.531 345.097 137.489 340.576C137.29 320.355 132.518 295.125 124.074 288.185C123.339 287.581 122.996 286.618 123.181 285.685C123.264 285.272 131.276 244.143 118.087 227.604C117.228 226.526 117.27 224.925 118.286 223.99C119.398 222.98 121.108 223.118 122.041 224.272C135.491 240.961 129.917 277.391 128.516 285.244C136.632 293.276 140.043 311.581 141.376 322.086C143.373 337.855 143.538 350.882 141.032 357.863C139.879 361.072 136.439 363.476 133.033 364.082C122.076 365.744 112.306 356.448 102.502 343.558C100.483 342.713 93.9406 338.845 85.8731 334.145C84.3832 333.279 82.5226 334.426 82.653 336.144C83.065 341.668 82.193 348.636 76.4738 352.099C70.7136 355.589 64.2391 356.88 58.2728 356.88C55.705 356.88 52.1829 355.864 49.8967 355.459C48.2283 355.163 46.6423 356.255 46.354 357.925C43.539 374.037 38.4859 420.705 53.7415 450.806C66.8619 476.689 98.3409 487.256 98.6566 487.359C99.6049 487.669 100.284 488.493 100.415 489.482C100.462 489.853 105.433 527.101 122.22 573.63C137.675 616.464 166.587 676.171 216.603 717.37C237.812 734.836 261.217 740.422 284.292 733.516C313.595 724.749 334.008 698.873 338.58 684.142C341.36 675.182 341.676 649.664 325.239 610.843L325.212 610.836Z" fill="#FFB689" />
              <path d="M105.957 339.601C106.122 339.765 106.259 339.951 106.376 340.15C112.892 348.767 119.353 354.744 125.594 357.864C130.585 360.358 136.503 357.074 137.059 351.522C137.34 348.698 137.519 345.105 137.471 340.583C137.272 320.363 132.5 295.133 124.055 288.193C123.32 287.589 122.978 286.626 123.163 285.692C123.245 285.28 131.258 244.151 118.069 227.612C117.21 226.533 117.252 224.933 118.268 223.998C119.379 222.981 121.089 223.125 122.023 224.28C135.473 240.969 129.898 277.398 128.498 285.252C136.613 293.284 140.025 311.588 141.357 322.094C143.355 337.863 143.519 350.89 141.014 357.871C139.86 361.079 136.421 363.484 133.015 364.089C122.057 365.752 112.288 356.455 102.484 343.566C100.465 342.727 93.9288 338.852 85.8615 334.152C84.3716 333.287 82.5041 334.434 82.6345 336.152C83.0465 341.669 82.1677 348.643 76.4554 352.106C71.9171 354.855 52.1782 355.679 47.3516 356.139C50.1253 356.867 101.35 351.687 128.573 417.496C133.015 428.229 137.286 421.351 138.995 415.264C147.646 384.427 176.187 338.22 239.64 307.184C236.639 297.393 216.543 232.586 213.09 221.297C210.344 221.463 207.597 221.662 204.872 221.868C192.322 222.795 179.695 223.805 167.172 222.033C163.032 221.449 159.078 220.494 155.28 219.188C154.903 219.552 154.47 219.882 153.489 219.773C152.507 219.662 151.69 219.202 151.024 218.536C150.461 217.979 149.918 217.402 149.383 216.804C144.666 214.613 140.204 211.822 135.968 208.422C130.764 204.251 126.094 199.482 121.852 194.309C105.333 183.755 85.0032 176.294 69.2601 188.139C60.3622 194.831 58.0621 205.481 57.911 214.255C58.3436 226.197 67.4475 261.98 82.0509 295.97C89.9053 314.247 97.9792 328.903 105.964 339.601H105.957Z" fill="url(#paint1_linear_2090_9254)" />
              <path d="M105.959 339.6C106.124 339.764 106.261 339.949 106.378 340.148C112.894 348.765 119.354 354.735 125.588 357.855C130.58 360.357 136.505 357.065 137.061 351.506C137.342 348.683 137.521 345.089 137.473 340.568C137.274 320.347 132.502 295.117 124.057 288.177C123.323 287.573 122.98 286.611 123.165 285.676C123.247 285.264 131.26 244.135 118.071 227.597C117.212 226.518 117.253 224.917 118.27 223.982C119.382 222.972 121.091 223.109 122.025 224.264C124.277 227.053 125.994 230.4 127.284 234.075C129.056 233.011 131.136 232.331 132.969 231.575C136.567 230.084 140.199 228.669 143.769 227.095C147.223 225.57 150.93 224.023 153.972 221.735C154.081 221.653 154.205 221.551 154.322 221.433C153.34 221.063 152.708 220.396 152.365 219.619C152.104 219.496 151.863 219.331 151.644 219.124C150.786 218.314 149.955 217.455 149.159 216.555C138.708 206.07 96.9037 167.325 69.2553 188.13C60.3573 194.823 58.0573 205.472 57.9062 214.247C58.3387 226.188 67.4428 261.972 82.0461 295.962C89.9001 314.239 97.9748 328.895 105.959 339.592V339.6Z" fill="url(#paint2_linear_2090_9254)" />
              <path d="M73.7787 347.681C81.7292 342.864 76.6623 331.074 75.3921 328.429C73.7444 327.309 72.0622 326.12 70.3458 324.87C55.1177 313.732 34.7608 295.098 21.146 268.075C20.3153 266.426 18.4753 265.56 16.6696 265.931C13.2847 266.631 8.81519 268.198 5.43038 271.682C1.68857 275.536 -0.05531 281.047 0.253648 288.062C2.0662 329.37 44.7642 348.925 46.9063 349.873C52.4125 351.797 64.1872 353.48 73.7787 347.667V347.681Z" fill="url(#paint3_linear_2090_9254)" />
              <path d="M132.528 112.248C132.528 112.248 139.442 118.474 148.724 122.816C150.421 123.606 151.169 125.605 150.427 127.323C146.76 135.768 138.961 162.008 152.768 212.845C152.768 212.845 125.841 183.974 132.528 112.248Z" fill="url(#paint4_linear_2090_9254)" />
              <path d="M286.417 190.131C286.417 190.131 264.914 243.73 298.686 269.043C300.347 270.293 299.221 273.825 297.141 273.805C268.017 273.536 254.965 289.642 244.117 305.459C244.117 305.459 244.083 276.484 271.697 261.959C271.697 261.959 266.128 208.483 286.423 190.131H286.417Z" fill="url(#paint5_linear_2090_9254)" />
              <path d="M154.226 214.166C154.226 214.166 167.524 230.698 175.688 234.785C175.688 234.785 163.083 235.981 150.477 217.718C150.477 217.718 153.463 220.494 155.283 219.188C157.103 217.883 154.233 214.166 154.233 214.166H154.226Z" fill="url(#paint6_linear_2090_9254)" />
              <path d="M98.625 487.359C98.625 487.359 110.091 491.722 121.467 491.592C123.575 491.571 125.024 493.694 124.173 495.626C119.936 505.265 111.333 529.863 117.458 559.84C117.458 559.84 102.71 511.016 98.6322 487.359H98.625Z" fill="url(#paint7_linear_2090_9254)" />
            </g>
          </g>
        </g>

        <defs>
          <linearGradient id="paint0_linear_2090_9254" x1="65.8726" y1="280.434" x2="51.3565" y2="284.963" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <linearGradient id="paint1_linear_2090_9254" x1="174.944" y1="517.091" x2="137.444" y2="296.351" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <linearGradient id="paint2_linear_2090_9254" x1="149.976" y1="320.155" x2="116.603" y2="256.86" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <linearGradient id="paint3_linear_2090_9254" x1="50.4283" y1="305.02" x2="27.9735" y2="313.178" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <linearGradient id="paint4_linear_2090_9254" x1="137.108" y1="116.927" x2="148.762" y2="180.913" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <linearGradient id="paint5_linear_2090_9254" x1="254.944" y1="242.583" x2="291.922" y2="261.847" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <linearGradient id="paint6_linear_2090_9254" x1="149.344" y1="217.594" x2="171.204" y2="228.987" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <linearGradient id="paint7_linear_2090_9254" x1="85.889" y1="507.993" x2="122.166" y2="526.9" gradientUnits="userSpaceOnUse">
            <stop stopColor="#F5A473" />
            <stop offset="1" stopColor="#FFB689" />
          </linearGradient>
          <clipPath id="clip0_2090_9254">
            <rect width="340" height="557" fill="white" />
          </clipPath>
        </defs>
      </svg>
    );
  }
);

Hand.displayName = "Hand";